webpackJsonp([2],{11:function(t,e,n){"use strict";function r(t,e,n){const r=t.getAttribute(e);if(null===r){if("function"==typeof n)throw new Error("cannot invoke on null");return void t.setAttribute(e,n)}if(c.getOrMakeInMap(u,t,{})[e]=r,"string"==typeof n)return void t.setAttribute(e,n);const o=n(r);t.setAttribute(e,o)}function o(t,e){const n=u.get(t);if(void 0===n)return;const r=n[e];void 0!==r&&(n[e]=void 0,t.setAttribute(e,r))}Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(7),a=n(25),c=n(13);e.tryGetElement=function(t,e=100,n=100){return s.__awaiter(this,void 0,void 0,function*(){const r=t.slice(1),o="#"===t[0]?()=>document.getElementById(r):()=>document.querySelector(t);return yield a.repeatUntil(o,i,e,n)})},e.removeAllChildren=function(t){let e;for(;e=t.firstChild;)t.removeChild(e)},e.byId=function(t){const e=document.getElementById(t);if(!e)throw new Error(`no element with id=${t} exists`);return e},e.attr=function(t,e){const n=t.getAttribute(e);if(!n)throw new Error(`no attribute ${e} on element with id=${t.id} exists`);return n};const u=new WeakMap;e.newAttributeValues=function(t,e){const{attributes:n}=t,o={};for(let r=0,i=n.length;r<i;++r){const{name:t,value:e}=n[r];o[t]=e}const s=e(o);for(const[i,a]of Object.entries(s))r(t,i,a)},e.restoreAttributes=function(t,...e){for(const n of e)o(t,n)}},13:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.intersection=function(t,e){const n=new Set;for(const r of t)e.has(r)&&n.add(r);return n},e.getOrMakeInMap=function(t,e,n){let r=t.get(e);return void 0===r&&(r="function"==typeof n?n():n,t.set(e,r)),r},e.tryGetFromMap=function(t,e){const n=t.get(e);if(void 0===n)throw console.error("in map",t,":",e,"->",n),new Error("key or val is undefined");return n},e.tryGetKeyFromBiMap=function(t,e){const n=t.getKey(e);if(void 0===n)throw console.error("in map",t,":",e,"->",n),new Error("key or val is undefined");return n}},144:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(145);var o=n(174);e.shortestRoute=o.default;const s=(t,e)=>t.filter(t=>t.has(e));e.findCycle=function(t,e){const{platforms:n}=e;if(n.length<3)return[];const{transfers:o}=t;if(3===n.length)return n.every(t=>2===s(o,t).length)?n:[];if(4===n.length){const t=n.map(t=>({platform:t,degree:o.filter(e=>e.has(t)).length})).sort((t,e)=>t.degree-e.degree),e=t.map(t=>t.degree),s=t.map(t=>t.platform);if(r(e,[2,2,3,3]))return s;if(r(e,[1,2,2,3]))return s.slice(1)}return[]}},174:function(t,e,n){"use strict";function r(t,e){if(t.station!==e.station)throw new Error(`platforms (${t.name} & ${e.name} must be on the same station`);const{platforms:n}=t.station,r=new Set(n),o=new Map,s=new Map;for(const c of n)o.set(c,1/0);o.set(t,0);let i=t;for(;r.size>0;){let t=1/0;for(const e of r){const n=c.tryGetFromMap(o,e);n<t&&(i=e,t=n)}r.delete(i);const e=i.transfers.map(t=>t.other(i));for(const n of e){if(!n||!r.has(n))continue;const t=u(i.location,n.location),e=c.tryGetFromMap(o,i)+t;e<c.tryGetFromMap(o,n)&&(o.set(n,e),s.set(n,i))}}const a=[],l=[];for(i=e;;){const t=s.get(i);if(!t)break;const e=i.transfers.find(e=>e.has(t));e?(a.push(e),i=t,l.push(i)):console.error("cannot find transfer node")}return l.pop(),{transfers:a.reverse(),midPlatforms:l.reverse()}}Object.defineProperty(e,"__esModule",{value:!0});const o=n(0),s=n(27),i=n(73),a=n(50),c=n(13),u=(t,e)=>o.LatLng.prototype.distanceTo.call(t,e);e.default=((t,e,n)=>{const o=new Map,l=new Map;for(const r of t){const t=r.spans.some(t=>t.routes[0].line.startsWith("E"));let s=u(e,r.location),i=s/1;const a=t?360:240;o.set(r,i+a),i=(s=u(r.location,n))/1,l.set(r,i)}let f=a.findClosestObject(e,t);const d=new Set(t),p=new Map;for(;d.size>0;){let t=1/0;for(const e of d){const n=c.tryGetFromMap(o,e);n<t&&(f=e,t=n)}d.delete(f);const e=[],n=[];for(const r of f.spans){const t=r.other(f);if(!d.has(t))continue;e.push(t);const o=u(f.location,t.location);const s=r.routes[0].line.startsWith("E")?40:25,a=i.timeToTravel(o,20,.7);n.push(a+s+0)}for(const r of f.station.platforms){if(!d.has(r))continue;e.push(r);const t=r.spans.some(t=>t.routes[0].line.startsWith("E")),o=u(f.location,r.location)/2;n.push(o/1+(t?360:240))}for(let r=0,s=e.length;r<s;++r){const t=e[r],s=c.tryGetFromMap(o,f)+n[r];s<c.tryGetFromMap(o,t)&&(o.set(t,s),p.set(t,f))}}let h=1/0;for(const[r]of o){const t=c.tryGetFromMap(o,r)+c.tryGetFromMap(l,r);t<h&&(h=t,f=r)}const m=u(e,n)/1;if(m<h)return{time:{walkTo:m}};const g=[],y=[f];for(let s=p.get(f);void 0!==s&&void 0!==s;s=p.get(f)){let t;for(const e of f.spans)if(e.has(s)){t=e;break}if(void 0===t)for(const e of f.transfers)if(e.has(s)){t=e;break}if(void 0===t){const{transfers:t,midPlatforms:e}=r(s,f);g.push(...t.reverse()),y.push(...e)}else g.push(t);y.push(s),f=s}y.reverse(),g.reverse();const b=c.tryGetFromMap(l,s(y)),v=c.tryGetFromMap(o,y[0]);return{platforms:y,edges:g,time:{walkTo:v,metro:h-b-v,walkFrom:b,total:h}}})},189:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(23);e.unit=Object.freeze(r.point(1,0)),e.isArbitrarilySmall=(t=>o.isArbitrarilySmall(t.x)&&o.isArbitrarilySmall(t.y)),e.round=((t,e)=>r.point(+t.x.toFixed(e),+t.y.toFixed(e))),e.mean=(t=>t.reduce((t,e)=>t.add(e)).divideBy(t.length)),e.dot=((t,e)=>t.x*e.x+t.y*e.y),e.det=((t,e)=>t.x*e.y-e.x*t.y),e.hypot=(t=>Math.sqrt(e.dot(t,t))),e.normalize=(t=>t.divideBy(e.hypot(t))),e.angle=((t,n)=>e.dot(t,n)/t.distanceTo(n)),e.orthogonal=(t=>[r.point(t.y,-t.x),r.point(-t.y,t.x)]),e.bisect=function(t,n){const o=e.normalize(t),s=e.normalize(n),i=o.add(s);return e.isArbitrarilySmall(i)?r.point(0,0):e.normalize(i)},e.intersection=function([t,n],[r,o]){const s=e.det(n,o);if(Math.abs(s)<Number.EPSILON)return null;const i=r.subtract(t),a=e.det(i,o)/s;return n.multiplyBy(a).add(t)}},190:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.eventListeners=new Map,this.publish=(t=>{console.log("event as seen from the dispatcher",t);const{type:e}=t,n=this.eventListeners.get(e);if(void 0===n||0===n.length)return console.log("no event listeners registered for",e),!1;for(const r of n)r(t);return!0})}subscribe(t,e){const n=this.eventListeners.get(t);void 0===n?this.eventListeners.set(t,[e]):n.push(e)}unsubscribe(t,e){const n=this.eventListeners.get(t);if(void 0===n)return;const r=n.indexOf(e);r<0||n.splice(r,1)}}e.default=r},191:function(t,e,n){"use strict";function r(t){for(const e of t){const t=a.default.outerEdgeBindings.get(e);if(void 0===t)continue;t.style.opacity=null;const n=a.default.innerEdgeBindings.get(e);void 0!==n&&(n.style.opacity=null),e instanceof l.Span&&c.filters.applyDrop(t)}}function o(t){for(const e of t){const t=a.default.platformBindings.get(e);t&&(t.style.opacity=null)}}Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(86),a=n(28),c=n(4),u=n(42),l=n(45),f=n(202);e.animation=f;const d=n(77);e.scale=d;const p=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map(t=>`#${t} *`).join(", ");e.visualizeRoute=function(t,e=!0){return s.__awaiter(this,void 0,void 0,function*(){const{platforms:n=[],edges:s,time:a}=t,c=u.formatTime(a.walkTo);if(void 0===s)return i.success(u.tr`${c} on foot!`);yield f.terminateAnimations();for(const{style:t}of document.querySelectorAll(p))t.filter=null,t.opacity="0.25";if(!e)return r(s),void o(n);(yield f.animateRoute(n,s))&&i.message(u.tr`TIME:<br>${c} on foot<br>${u.formatTime(a.metro)} by metro<br>${u.formatTime(a.walkFrom)} on foot<br>TOTAL: ${u.formatTime(a.total)}`,10)})},e.rehighlightEdges=r,e.rehighlightPlatforms=o},194:function(t,e,n){"use strict";function r(){const t=a.createSVGElement("filter");return t.id="shadow",t.setAttribute("width","200%"),t.setAttribute("height","200%"),t.innerHTML=`\n        <feOffset\n            result="offOut"\n            in="SourceAlpha"\n            dx="0"\n            dy="4"\n        />\n        <feColorMatrix\n            result="matrixOut"\n            in="offOut"\n            type="matrix"\n            values="\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0.5 0\n            "\n        />\n        <feGaussianBlur\n            result="blurOut"\n            in="matrixOut"\n            stdDeviation="2"\n        />\n        <feBlend\n            in="SourceGraphic"\n            in2="blurOut"\n            mode="normal"\n        />\n    `,t}function o(){const t=a.createSVGElement("filter");return t.id=c,t.innerHTML=`\n        <feColorMatrix\n            type="matrix"\n            values="\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0   0\n                0 0 0 0.3 0\n            "\n        />\n        <feGaussianBlur\n            stdDeviation="2.5"\n            result="coloredBlur"\n        />\n        <feMerge>\n            <feMergeNode in="coloredBlur"/>\n            <feMergeNode in="SourceGraphic"/>\n        </feMerge>\n    `,t}function s(){const t=a.createSVGElement("filter");return t.id="opacity",t.innerHTML=`\n        <feComponentTransfer>\n            <feFuncA type="table" tableValues="0 0.5">\n        </feComponentTransfer>\n    `,t}function i(){const t=a.createSVGElement("filter");return t.id="gray",t.innerHTML=`\n        <feColorMatrix\n            type="matrix"\n            values="\n                0.2126 0.7152 0.0722 0 0\n                0.2126 0.7152 0.0722 0 0\n                0.2126 0.7152 0.0722 0 0\n                0 0 0 1 0\n            "\n        />\n    `,t}Object.defineProperty(e,"__esModule",{value:!0});const a=n(4),c="black-glow";e.makeDrop=r,e.makeGlow=o,e.makeOpacity=s,e.makeGray=i,e.appendAll=function(t){t.appendChild(r()),t.appendChild(o()),t.appendChild(s()),t.appendChild(i())},e.applyDrop=function(t){const e=t.getBoundingClientRect(),n=getComputedStyle(t),r=2*parseFloat(n.strokeWidth||t.style.strokeWidth||"0");e.height>=r&&e.width>=r&&(t.style.filter=`url(#${c})`)}},195:function(t,e,n){"use strict";function r(t){const e=i.createSVGElement("linearGradient");return e.innerHTML=`<stop style="stop-color:${t[0]}" /><stop style="stop-color:${t[1]}" />`,e}function o(t,e){const n=`rotate(${180*Math.atan2(e.y,e.x)/Math.PI}, 0.5, 0.5)`;t.setAttribute("gradientTransform",n)}function s(t,e){t.firstChild.setAttribute("offset",e.toString()),t.lastChild.setAttribute("offset",(1-e).toString())}Object.defineProperty(e,"__esModule",{value:!0});const i=n(4);e.makeLinear=function(t,e,n=0){const i=r(e);return s(i,n),o(i,t),i},e.setDirection=o,e.setOffset=s},196:function(t,e,n){"use strict";function r(t,e,n){const r=i.getCircumcenter([t,e,n]);if(null===r)return{radius:1/0};const o=t.subtract(n),s=e.subtract(n),a=i.vector.dot(o,s)<0,c=t.subtract(r),u=e.subtract(r),l=i.vector.det(c,u)>=0;return{radius:r.distanceTo(t),large:a?1:0,clockwise:l&&!a||a&&!l?1:0}}function o(t,e,n,o){const{radius:s,large:i,clockwise:a}=r(e,n,o),c=["M",e.x,e.y,...s===1/0?["L"]:["A",s,s,0,i,a],n.x,n.y].join(" ");t.setAttribute("d",c)}Object.defineProperty(e,"__esModule",{value:!0});const s=n(4),i=n(23);e.getPath=function(t){const e=[],n=/\D([\d\.]+)/g,r=t.getAttribute("d");if(!r)return null;let o;for(;null!==(o=n.exec(r));)e.push(Number(o[1]));return e},e.setPath=o,e.create=function(t,e,n){const r=s.createSVGElement("path");return o(r,t,e,n),r}},197:function(t,e,n){"use strict";function r(t){if(t.length>3)throw new Error(`the tail should consist of 1-3 elements, but got ${t.length} instead`);return`${a[t.length]} ${t.map(t=>`${t.x} ${t.y}`).join(" ")}`}function o(t,e,...n){if(e.length<2)throw new Error(`there should be at least 2 control points, but got ${e.length} instead`);const[o,...s]=e;n.unshift(s);const i=n.map(r).join(" ");t.setAttribute("d",`M ${o.x} ${o.y} ${i}`)}Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=n(4);e.getPathPoints=function(t){const e=[],n=/\D([\d\.]+).*?,.*?([\d\.]+)/g,r=t.getAttribute("d");if(!r)return null;let o;for(;null!==(o=n.exec(r));)e.push(s.point(Number(o[1]),Number(o[2])));return e};const a=["","L","Q","C"];e.setPath=o,e.create=function(t,...e){const n=i.createSVGElement("path");return o(n,t,...e),n}},198:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e,n={},r){this.spans=[],this.transfers=[],this.name=t,this.altNames=n,this.location=e,this.elevation=r}get station(){return this._station}passingRoutes(){const t=new Set;for(const e of this.spans)for(const n of e.routes)t.add(n);return t}passingLines(){const t=new Set;for(const e of this.spans)for(const n of e.routes)t.add(n.line);return t}}e.default=r},199:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(25);class o{constructor(t){this.platforms=t;for(const e of t)e._station=this}getNames(){return r.getPlatformNamesZipped(this.platforms)}getCenter(){return r.geo.getCenter(this.platforms.map(t=>t.location))}passingLines(){const t=new Set;for(const e of this.platforms)for(const n of e.spans)for(const e of n.routes)t.add(e.line);return t}}e.default=o},200:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(29),o=n(37);class s extends o.default{constructor(t,e,n){super(t,e),t.spans.push(this),e.spans.push(this),this.routes=n}get source(){return this._source}set source(t){void 0!==this._source&&r.default(this._source.spans,this),this._source=t,t.spans.push(this)}get target(){return this._target}set target(t){void 0!==this._target&&r.default(this._target.spans,this),this._target=t,t.spans.push(this)}}e.default=s},201:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(29),o=n(37);class s extends o.default{constructor(t,e){super(t,e),t.transfers.push(this),e.transfers.push(this)}get source(){return this._source}set source(t){void 0!==this._source&&r.default(this._source.transfers,this),this._source=t,t.transfers.push(this)}get target(){return this._target}set target(t){void 0!==this._target&&r.default(this._target.transfers,this),this._target=t,t.transfers.push(this)}}e.default=s},202:function(t,e,n){"use strict";function r(t,e){return s.__awaiter(this,void 0,void 0,function*(){const n=e.length,r=document.getElementById("transfers-outer");for(let i=0;i<n;++i){if(!y)return!1;const n=f.tryGetFromMap(u.default.platformBindings,t[i]);n.style.opacity=null,g&&o(n,_,M);const s=e[i],c=s instanceof h.Transfer,p=u.default.outerEdgeBindings.get(e[i]);if(!p||c&&p.parentNode!==r)continue;const m=u.default.innerEdgeBindings.get(e[i]),b=p.cloneNode(!0),x=void 0===m?void 0:m.cloneNode(!0),S=d.byId("paths-outer");S.appendChild(b);const k=d.byId("paths-inner");x&&k.appendChild(x),l.filters.applyDrop(b);const E=c?w:v,O=s.source!==t[i],A=[a.default(b,E,O)];x&&A.push(a.default(x,E,O)),yield Promise.all(A),p.style.opacity=null,l.filters.applyDrop(p),S.removeChild(b),m&&(m.style.opacity=null),x&&k.removeChild(x)}const s=f.tryGetFromMap(u.default.platformBindings,c(t));return s.style.opacity=null,g&&o(s,x,M),!0})}function o(t,e,n){return s.__awaiter(this,void 0,void 0,function*(){const{style:r}=t;r.transition=`transform ${n/2}ms linear`,t.getBoundingClientRect(),m.scaleElement(t,e),yield p.transitionEnd(t),r.transform="scale(1)",yield p.transitionEnd(t),r.transition=null,r.transform=null})}Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(0),a=n(203),c=n(27),u=n(28),l=n(4),f=n(13),d=n(11),p=n(53),h=n(45),m=n(77),g=i.Browser.webkit&&!i.Browser.mobile;let y=!0,b=null;const v=1,w=.25,_=1.5,x=3,M=200;e.terminateAnimations=function(){return null===b?Promise.resolve(!0):(y=!1,b)},e.animateRoute=function(t,e){return b=r(t,e).then(t=>(b=null,y=!0,t))},e.pulsateCircle=o},205:function(t,e,n){"use strict";function r(t){let e=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(e)return e.slice(1).map(Number);if(!t.startsWith("#"))throw new Error(`invalid css color: ${t}`);if(7===t.length?e=t.match(/[0-9a-f]{2}/gi):4===t.length&&(e=t.slice(1).split("").map(t=>t+t)),!e)throw new Error(`invalid css color: ${t}`);return e.map(t=>parseInt(t,16))}Object.defineProperty(e,"__esModule",{value:!0});const o=n(206),s=n(207),i=n(210),a=n(215);e.meanColor=function(t){const e=t.map(r);return`#${a(e,(...t)=>o(t)).map(t=>i(s(t).toString(16),2,"0")).join("")}`}},225:function(t,e,n){var r=n(226);"string"==typeof r&&(r=[[t.i,r,""]]);var o={};o.transform=void 0;n(9)(r,o);r.locals&&(t.exports=r.locals)},226:function(t,e,n){(t.exports=n(8)(void 0)).push([t.i,"body,html{height:100%}body{margin:0;padding:0}a{color:#2196f3}a:hover{color:#e91e63}#map-container{height:100%;font-size:12px;cursor:default}.leaflet-dragging #map-container{cursor:-webkit-grab;cursor:grab}#map-container.dimmed{-webkit-filter:brightness(.75);filter:brightness(.75);-webkit-transition-property:-webkit-filter;transition-property:-webkit-filter;transition-property:filter;transition-property:filter,-webkit-filter;-webkit-transition-duration:.2s;transition-duration:.2s}.leaflet-control-scale-line{opacity:1}.ajs-message{bottom:20px;background-color:#ccc;font-family:Segoe,Tahoma,Ubuntu}@media only screen and (max-device-width:1000px) and (-webkit-min-device-pixel-ratio:2){.leaflet-control-attribution{display:none}}#wait{position:fixed;top:50%;left:50%;font-family:Arial,Helvetica,sans-serif;font-size:1.2em;z-index:1;color:#606060;opacity:0;-webkit-transition:opacity 2s linear;transition:opacity 2s linear}button{background-color:#fff;border:none;height:25px;border-radius:2px;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);cursor:pointer;-webkit-transition:-webkit-box-shadow .1s;transition:-webkit-box-shadow .1s;transition:box-shadow .1s;transition:box-shadow .1s,-webkit-box-shadow .1s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline-width:0}button:hover{background-color:#f0f0f0}button:active{-webkit-box-shadow:none;box-shadow:none}button:disabled{background:#eaeaea;color:#a8a8a8;cursor:auto}",""])},227:function(t,e,n){var r=n(228);"string"==typeof r&&(r=[[t.i,r,""]]);var o={};o.transform=void 0;n(9)(r,o);r.locals&&(t.exports=r.locals)},228:function(t,e,n){(t.exports=n(8)(void 0)).push([t.i,"path{fill-opacity:0}circle{-webkit-transform-origin:50% 50%;transform-origin:50% 50%}@-moz-document url-prefix(){circle{transform-origin:0 0}}#station-circles{fill:#fff;stroke:#000}#dummy-circles{opacity:0;stroke:blue;stroke-width:.5px}#paths-inner,#paths-outer,#transfers-inner,#transfers-outer{fill:none}#transfers-outer{stroke:#404040}#transfers-inner{stroke:#fff}",""])},23:function(t,e,n){"use strict";function r(t,e){const n=w(t,e),r=n.length>>1;return[n.slice(0,r+1),n.slice(r)]}function o(t,n){if(!e.isNatural(n))throw new Error(`k must be a natural number, got ${n} instead`);if(1===n)return[t];const[s,i]=r(t,1/n);return[s,...o(i,n-1)]}function s(t,e){if(2!==t.length)throw new Error("line must have 2 points");if(t[0].equals(t[1]))throw new Error("points are overlapped");const n=t[1].subtract(t[0]),[r]=m(n),o=g(r).multiplyBy(e);return t.map(t=>t.add(o))}Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),a=n(188),c=n(27),u=n(189);e.vector=u;const l=n(73);e.phys=l;const{bisect:f,dot:d,det:p,intersection:h,orthogonal:m,normalize:g}=u;e.isNatural=(t=>t>0&&Number.isInteger(t)),e.isArbitrarilySmall=(t=>Math.abs(t)<=Number.EPSILON);const y=(t,e,n)=>e.subtract(t).multiplyBy(n).add(t),b=(t,e)=>t.slice(1).map((n,r)=>y(t[r],n,e)),v=(t,e)=>w(b(t,e),e),w=(t,e)=>t.length<2?t:[a(t),...v(t,e),c(t)];e.splitInTwo=r,e.split=o,e.offsetLine=s,e.offsetPath=function(t,e){if(t.length<2)throw new Error("there should be at least 2 control points for an offset");return t.map((n,r)=>{const o=t[r-1],i=t[r+1];if(!o)return s([n,i],e)[0];if(!i)return s([o,n],e)[1];const[a,c]=s([o,n],e),[u]=s([i,n],-e),l=o.subtract(n),f=i.subtract(n);return h([a,l],[u,f])||c})},e.wings=function(t,e,n,r=1){const o=t.subtract(e),s=n.subtract(e),i=f(o,s),a=p(o,s)<0?-r:r;return m(i.multiplyBy(a))},e.getCircumcenter=function(t){if(3!==t.length)throw new Error("must have 3 vertices");const e=t[0],n=t[1].subtract(e),r=t[2].subtract(e),o=d(n,n),s=d(r,r),a=p(n,r);return Math.abs(a)<Number.EPSILON?null:i.point(r.y*o-n.y*s,n.x*s-r.x*o).divideBy(2*a).add(e)},e.vectorToGradCoordinates=function(t){const e=Math.abs(t.x),n=Math.abs(t.y);return t.divideBy(e<n?n:e)}},25:function(t,e,n){"use strict";function r(t){const{name:e,altNames:n}=t,r=o(),s=[e];return r&&n[r]&&s.push(n[r]),n.en&&s.push(n.en),s}function o(){const t=location.search.match(/city=(\w+)/);return{spb:"fi",qazan:"tt",helsinki:"se"}[t?t[1]:"spb"]}Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(0),a=n(94),c=n(106),u=n(117),l=n(7),f=n(144);e.algorithm=f;const d=n(50);e.geo=d;const p=n(23);e.math=p;const h=n(190);e.Mediator=h.default;const m=n(191);e.sfx=m;const g=n(4);e.svg=g;const y=n(205);e.color=y;const b=n(11);e.dom=b;const v=n(53);e.events=v;const w=n(13);e.collections=w;const _=["paths-inner","paths-outer","transfers-inner","transfers-outer","station-circles"].map(t=>`#${t} > *`).join(", ");e.proxify=(t=>`https://proxy-antonv.rhcloud.com/?url=${t}`),e.mouseToLatLng=function(t,e){const{top:n,left:r}=t.getContainer().getBoundingClientRect(),o=i.point(e.clientX-r,e.clientY-n);return t.containerPointToLatLng(o)},e.resetStyle=function(){const t=document.querySelectorAll(_);for(const{style:e}of t)e.opacity=null,e.filter=null},e.getPlatformNames=r,e.getPlatformNamesZipped=function(t){const e=t.map(r);return c(...e).map(t=>u(t).join(" / ")).filter(l)},e.midPointsToEnds=function(t,e){const n=e.map(e=>t.distanceTo(e)),r=e[1].subtract(e[0]).multiplyBy(n[0]/(n[0]+n[1])).add(e[0]),o=t.subtract(r);return e.map(t=>p.vector.round(t.add(o),2))},e.repeatUntil=function(t,e,n=100,r=100){return s.__awaiter(this,void 0,void 0,function*(){for(let o=0;o<r;++o){const r=t();if(e(r))return r;yield a.default(n)}throw new Error("rejected")})},e.tryRun=function(t,e=100,n=100){return s.__awaiter(this,void 0,void 0,function*(){for(let r=0;r<n;++r)try{return t()}catch(t){yield a.default(e)}throw new Error("rejected")})},e.getSecondLanguage=o,e.drawBezierHints=function(t,e,n){for(let r=1;r<e.length;++r){const o=g.createSVGElement("line");o.setAttribute("x1",e[r-1].x.toString()),o.setAttribute("y1",e[r-1].y.toString()),o.setAttribute("x2",e[r].x.toString()),o.setAttribute("y2",e[r].y.toString());const s=["#000"];n&&s.push(n),o.style.stroke=y.meanColor(s),o.style.strokeOpacity="0.75",o.style.strokeWidth="1px",t.appendChild(o)}}},28:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(192),o={platformBindings:new WeakMap,dummyBindings:new r.WeakBiMap,outerEdgeBindings:new r.WeakBiMap,innerEdgeBindings:new r.WeakBiMap,gradientBindings:new WeakMap};e.default=Object.freeze(o)},37:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e){if(t===e)throw new Error(`source is the same as target: ${t}`);this._source=t,this._target=e}get source(){return this._source}set source(t){this._source=t}get target(){return this._target}set target(t){this._target=t}isOf(t,e){return this._source===t&&this._target===e||this._source===e&&this._target===t}has(t){return this._source===t||this._target===t}other(t){if(this._source===t)return this._target;if(this._target===t)return this._source;throw new Error("span does not have vertex")}isAdjacent(t){return this.has(t._source)||this.has(t._target)}invert(){const t=this._source;this._source=this._target,this._target=t}}e.default=r},4:function(t,e,n){"use strict";function r(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function o(t,e){const n=r("line");return n.setAttribute("x1",t.x.toString()),n.setAttribute("y1",t.y.toString()),n.setAttribute("x2",e.x.toString()),n.setAttribute("y2",e.y.toString()),n}Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=n(11),a=n(23),c=n(194);e.filters=c;const u=n(195);e.gradients=u;const l=n(196);e.arc=l;const f=n(197);e.bezier=f,e.createSVGElement=r,e.makePolygon=function(t){const e=r("polygon"),n=t.map(t=>`${t.x},${t.y}`).join(" ");return e.setAttribute("points",n),e},e.makeCircle=function(t,e){const n=r("circle");return n.setAttribute("r",e.toString()),n.setAttribute("cy",t.y.toString()),n.setAttribute("cx",t.x.toString()),n},e.makeLine=o,e.makeStadium=function(t,e,n){const o=r("rect");o.setAttribute("x",(t.x-.5*e-n).toString()),o.setAttribute("y",(t.y-n).toString());const s=2*n;return o.setAttribute("width",(e+s).toString()),o.setAttribute("height",s.toString()),o.setAttribute("rx",n.toString()),o.setAttribute("ry",n.toString()),o.style.transformOrigin="50% 50%",o},e.makeOvalStartEnd=function(t,e,n){const o=e.subtract(t),s=a.vector.orthogonal(o.multiplyBy(-1)).map(e=>e.add(t)),i=a.vector.orthogonal(o).map(t=>t.add(e)),c=["M",s[0].x,s[0].y,"A",n,n,"0 0 1",s[1].x,s[1].y,"L",i[0].x,i[0].y,"A",n,n,"0 0 1",i[1].x,i[1].y,"L",s[0].x,s[0].y,"Z"],u=r("path");return u.setAttribute("d",c.join(" ")),u.style.fillOpacity="1",u},e.makeTransferArc=function(t,e,n){const r=l.create(t,e,n);return[r,r.cloneNode(!0)]},e.makeTransferLine=function(t,e){const n=e.clone();return t.x===e.x?n.x+=.01:t.y===e.y&&(n.y+=.01),[o(t,n),o(t,n)]},e.getElementOffset=function(t){const e=t.getAttribute("cx");if(null===e){const e=+i.attr(t,"x")+ +i.attr(t,"width")/2,n=+i.attr(t,"y")+ +i.attr(t,"height")/2,r=s.point(e,n),o=~~i.attr(t,"rx"),a=s.point(0+o,4+o);return r.subtract(a)}const n=s.point(+e,+i.attr(t,"cy")),r=~~i.attr(t,"r"),o=s.point(0+r,4+r);return n.subtract(o)}},42:function(t,e,n){"use strict";function r(t){const e=c.get(t.toLowerCase());return void 0===e?t:t.toUpperCase()===t?e.toUpperCase():e}function o(t,...e){return t.map(t=>t.replace(u,r)).map((t,n)=>t+(e[n]||"")).join("")}function s(t,n){return 0===t?"":`${t}${t>1&&"en"===e.userLanguage?n+"s":n}`}Object.defineProperty(e,"__esModule",{value:!0});const i=n(3),a=n(46);e.userLanguage=navigator.language.slice(0,2).toLowerCase();const c=new Map;let u=new RegExp(Object.keys(c).join("|"),"ig");e.updateDictionary=function(t){return i.__awaiter(this,void 0,void 0,function*(){const n=yield a.getJSON(t),r=Object.keys(n);for(const t of r){const r=n[t];c.set(t.toLowerCase(),e.userLanguage in r?r[e.userLanguage]:t)}u=new RegExp(r.join("|"),"ig")})},e.translate=r,e.tr=o,e.formatTime=function(t){if(void 0===t)return"";if(t<60)return`${Math.round(t)} seconds`;if(t<3570)return s(Math.round(t/60),"min");const e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60);return`${e>0?e+o`%hour%`:""} ${s(n,"min")}`}},45:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(29),s=n(198);e.Platform=s.default;const i=n(199);e.Station=i.default;const a=n(37);e.Edge=a.default;const c=n(200);e.Span=c.default;const u=n(201);e.Transfer=u.default;class l{constructor(t){const e=t=>r.latLng(t.lat,t.lng);this.platforms=t.platforms.map(t=>new s.default(t.name,e(t.location),t.altNames)),this.stations=[],this.routes=t.routes,this.lines=t.lines,this.transfers=t.transfers.map(t=>new u.default(this.platforms[t.source],this.platforms[t.target]));const n=t=>t.routes.map(t=>this.routes[t]);this.spans=t.spans.map(t=>new c.default(this.platforms[t.source],this.platforms[t.target],n(t))),console.time("restore");const o=new Set(this.transfers),a=new Set(this.platforms);for(;o.size>0;){const t=o.values().next().value,e=new Set([t.source,t.target]);o.delete(t);for(const n of e){const t=new Set;for(const r of o)r.source===n?(e.add(r.target),t.add(r)):r.target===n&&(e.add(r.source),t.add(r));for(const e of t)o.delete(e);a.delete(n)}const n=new i.default(Array.from(e));this.stations.push(n)}for(const r of a)this.stations.push(new i.default([r]));console.timeEnd("restore")}toJSON(){const{platforms:t,transfers:e,lines:n,spans:r,routes:o}=this;return JSON.stringify({version:Date.now(),platforms:t.map(t=>({name:t.name,altNames:t.altNames,location:t.location})),transfers:e.map(e=>({source:t.indexOf(e.source),target:t.indexOf(e.target)})),lines:n,spans:r.map(e=>({source:t.indexOf(e.source),target:t.indexOf(e.target),routes:e.routes.map(t=>o.indexOf(t))})),routes:o},(t,e)=>t.startsWith("_")?void 0:e,2)}deletePlatform(t){console.log("removing platform",t);const{transfers:e,spans:n,station:r}=t;for(const s of e)o.default(this.transfers,s);if(e.length=0,1===n.length){const e=n[0],r=e.other(t);o.default(r.spans,e),o.default(this.spans,e)}else if(2===n.length){const[e,r]=n,s=r.other(t);if(!s)throw new Error(`span does not have other end`);if(2===t.passingRoutes().size){const n=e.other(t);o.default(n.spans,e),o.default(this.spans,e)}else e.source===t?e.source=s:e.target=s;o.default(s.spans,r),o.default(this.spans,r)}else for(const s of n){const e=s.other(t);o.default(e.spans,s),o.default(this.spans,s)}1===r.platforms.length?o.default(this.stations,r):o.default(r.platforms,t),o.default(this.platforms,t)}}e.default=l},46:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(3),o=n(25),s=Date.now();e.cachelessFetch=(t=>fetch(`${t}?${s}`)),e.getJSON=(t=>e.cachelessFetch(t).then(t=>t.json())),e.getLineRules=function(){return r.__awaiter(this,void 0,void 0,function*(){const t=new Map,e=document.getElementById("scheme"),n=yield o.tryRun(()=>e.sheet.cssRules);for(const r of n){if(!(r instanceof CSSStyleRule))continue;const e=r.selectorText.split(",").map(t=>t.trim());for(const n of e){const e=n.match(/^.(M\d+|L|E)$/);e&&e[1]&&t.set(e[1],r.style)}}return console.log(t),t})}},50:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(175);e.getCenter=(t=>r.latLng(o(t,t=>t.lat),o(t,t=>t.lng))),e.findClosestObject=function(t,e){const{length:n}=e;if(n<1)throw new Error("an objects array must contain at least 1 object");let r=e[0];const o=t=>t.location||t;let s=t.distanceTo(o(r));for(let i=1;i<n;++i){const n=e[i],a=t.distanceTo(o(n));a<s&&(r=n,s=a)}return r},e.findObjectsWithinRadius=function(t,e,n,r=!1){const o=e.map(e=>({item:e,distance:t.distanceTo(e.location)})).filter(t=>t.distance<=n);return r&&o.sort((t,e)=>t.distance-e.distance),o.map(t=>t.item)};const s=.61803398875;e.calculateGeoMedian=function(t,n,o=1e-5,i){let a=e.getCenter(t),c=n(a);const u=r.latLngBounds(t),l=Math.max(u.getEast()-u.getWest(),u.getNorth()-u.getSouth());i&&i(a);for(let e=l;e>o;e*=s){const t=e;let o=a,s=c;for(let i=-t;i<=t;i+=e)for(let c=-t;c<=t;c+=e){const t=r.latLng(a.lat+i,a.lng+c),e=n(t);e<s&&(o=t,s=e)}a=o,c=s,i&&i(a)}return a}},53:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.once=((t,e)=>new Promise(n=>{t.addEventListener(e,function r(o){t.removeEventListener(e,r),n(o)})})),e.onceEscapePress=function(t){function e(){removeEventListener("keydown",n),removeEventListener("backbutton",r)}const n=n=>{27===n.keyCode&&(e(),t(n))},r=n=>{e(),t(n)};addEventListener("keydown",n),addEventListener("backbutton",r)},e.transitionEnd=(t=>e.once(t,"transitionend")),e.triggerMouseEvent=function(t,e){const n=document.createEvent("MouseEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}},73:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.timeToTravel=function(t,e,n){const r=e*e/n;return r<t?e/n*2+(t-r)/e:2*Math.sqrt(t/n)}},77:function(t,e,n){"use strict";function r(t,e){u.add(t),c.newAttributeValues(t,({r:t})=>({r:(+t*e).toString()}))}function o(t,e){l.add(t),c.newAttributeValues(t,({x:t,y:n,width:r,height:o,rx:s,ry:i})=>{const a=+o*(e-1),c=a/2;return{x:(+t-c).toString(),y:(+n-c).toString(),width:(+r+a).toString(),height:(+o*e).toString(),rx:(+s*e).toString(),ry:(+i*e).toString()}})}Object.defineProperty(e,"__esModule",{value:!0});const s=n(28),i=n(11),a=n(13),c=n(11),u=new Set,l=new Set,f=new Set;e.scaleElement=function(t,e,n=!1){n?t instanceof SVGCircleElement?r(t,e):t instanceof SVGRectElement&&o(t,e):t.style.transform=`scale(${e})`},e.scaleCircleAsAttribute=r,e.scaleStadiumAsAttribute=o,e.scaleTransfer=function(t,e){const n=parseFloat(i.byId("transfers-outer").style.strokeWidth||""),r=parseFloat(i.byId("transfers-inner").style.strokeWidth||""),o=a.tryGetFromMap(s.default.outerEdgeBindings,t),c=a.tryGetFromMap(s.default.innerEdgeBindings,t);f.add(o),f.add(c),o.style.strokeWidth=n*e+"px",c.style.strokeWidth=r*e+"px"},e.unscaleAll=function(){for(const t of u)c.restoreAttributes(t,"r");for(const t of l)c.restoreAttributes(t,"x","y","width","height","rx","ry");for(const t of f)t.style.strokeWidth=null;f.clear(),u.clear(),l.clear(),l.clear()}},98:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(3),o=n(0),s=n(99),i=n(46),a=n(42);if(n(216),n(221),n(223),n(225),n(227),n(229),o.Icon.Default.imagePath="http://cdn.leafletjs.com/leaflet/v0.7.7/images",o.Browser.ie)throw alert("Does not work in your browser (yet)"),new Error("shitty browser");const c=i.getJSON("res/mapconfig.json"),u=o.Browser.mobile?n.e(0).then(n.bind(null,254)):Promise.all([n.e(0),n.e(1)]).then(n.bind(null,255)),l=location.search.match(/city=(\w+)/),f=l?l[1]:"spb";(()=>r.__awaiter(this,void 0,void 0,function*(){const t=yield c,e=a.updateDictionary(t.url.dictionary);for(const n of Object.keys(t.url))t.url[n]=t.url[n].replace(/\{city\}/g,f);document.title=a.translate(`${f&&"spb"!==f?s(f):"St Petersburg"} metro plan proposal`),yield e,document.title=a.translate(document.title),new(yield u).default(t)}))()}},[98]);